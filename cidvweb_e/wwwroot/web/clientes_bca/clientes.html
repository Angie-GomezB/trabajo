<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Clientes - Sistema de Facturación FEDEX</title>

    <link rel="Shortcut Icon" href="../../img/ico/ico-serlefin.png" type="image/png">
    <link rel="stylesheet" href="../../css/lib/beer.min.css">
    <link rel="stylesheet" href="../../css/own/colors.css">
    <link rel="stylesheet" href="../../css/own/main.css">

    <script src="../../js/lib/vue.global.js"></script>
    <script src="../../js/lib/axios.min.js"></script>
    <script src="../../js/own/axios-helper.js"></script>
</head>
<body>
    <div id="clientesBcaDiv">

        <!-- HEADER FIJO FEDEX -->
        <header class="primary" style="position: sticky; top: 0; z-index: 100;">
            <nav class="padding">
                <div class="row">
                    <div class="max">
                        <div class="row">
                            <img src="../../img/background/logo_nuevo3.png" alt="FedEx" style="height: 50px; width:auto">
                            <h6 class="small-margin">Sistema de Facturación</h6>
                        </div>
                    </div>
                    <div class="center-align">
                    </div>
                </div>
                <p class="tiny-text no-margin white-text" style="position: absolute; right: 80px; top: 50%; transform: translateY(-50%);">{{ sucursalNombre }}</p>
            </nav>
        </header>

        <main class="responsive">
            <div style="height: 12px;"></div>

            <!-- ============================================================ -->
            <!-- PANTALLA: GESTIÓN DE CLIENTES (principal - antes "buscar")   -->
            <!-- ============================================================ -->
            <div v-if="pantalla === 'buscar'" class="margin" style="margin-top: 0; margin-bottom: 0;">
                <div class="row" style="margin-bottom: 6px;">
                    <div class="max">
                        <h5 class="primary-text" style="margin: 0 0 2px 0;">Gestión de Clientes</h5>
                        <p class="no-margin" style="margin: 0; font-size: 0.85rem;">Búsqueda y registro de clientes</p>
                    </div>
                    <button class="secondary" @click="abrirFormularioNuevo" v-bind:disabled="cargandoTodos">
                        <i>person_add</i>
                        <span>Nuevo Cliente</span>
                    </button>
                </div>

                <!-- Tabla con filtros en encabezados -->
                <article class="border round">

                    <!-- Loading inicial -->
                    <div v-if="cargandoTodos" class="center-align padding">
                        <progress class="circle medium"></progress>
                        <p>Cargando clientes...</p>
                    </div>

                    <div v-else>
                        <!-- Sin clientes en absoluto -->
                        <div v-if="todosClientesCache.length === 0" class="padding center-align">
                            <i class="extra">group_off</i>
                            <p>No hay clientes registrados aún.</p>
                            <div class="space"></div>
                            <button class="secondary" @click="abrirFormularioNuevo">
                                <i>person_add</i>
                                <span>Crear primer cliente</span>
                            </button>
                        </div>

                        <div v-else>
                            <!-- Tabla con scroll interno -->
                            <div id="tablaClientesScroll"
                                 style="max-height: calc(100vh - 175px); overflow-y: auto;"
                                 @scroll="onScrollTabla">
                                <table class="border" style="width:100%;">
                                    <thead style="position: sticky; top: 0; z-index: 10; background: var(--surface);">
                                        <tr>
                                            <!-- Encabezado ID Fiscal con filtro -->
                                            <th style="min-width:150px; padding: 4px 8px;">
                                                <div class="field border no-margin" style="margin:0;">
                                                    <input type="text"
                                                           v-model="filtroIdFiscal"
                                                           @input="aplicarFiltros"
                                                           placeholder="ID Fiscal"
                                                           maxlength="20"
                                                           style="height:28px; font-size:0.80rem; padding: 3px 8px;">
                                                </div>
                                            </th>
                                            <!-- Encabezado Nombre con filtro -->
                                            <th style="min-width:210px; padding: 4px 8px;">
                                                <div class="field border no-margin" style="margin:0;">
                                                    <input type="text"
                                                           v-model="filtroNombre"
                                                           @input="aplicarFiltros"
                                                           placeholder="Nombre / Apellido"
                                                           maxlength="200"
                                                           style="height:28px; font-size:0.80rem; padding: 3px 8px;">
                                                </div>
                                            </th>
                                            <th style="min-width:170px; padding: 4px 8px; font-size:0.80rem;">Email</th>
                                            <th style="min-width:110px; padding: 4px 8px; font-size:0.80rem;">Teléfono</th>
                                            <th style="min-width:100px; padding: 4px 8px; font-size:0.80rem;">Ciudad</th>
                                            <th class="center-align" style="min-width:75px; padding: 4px 8px; font-size:0.80rem;">Estado</th>
                                            <th class="center-align" style="min-width:80px; padding: 4px 8px; font-size:0.80rem;">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Sin resultados tras filtrar -->
                                        <tr v-if="clientesFiltrados.length === 0">
                                            <td colspan="7">
                                                <div class="center-align padding">
                                                    <i class="extra secondary-text">person_search</i>
                                                    <div class="space"></div>
                                                    <h6>No se encontró ningún cliente</h6>
                                                    <p>
                                                        No existe un cliente con los datos ingresados.<br>
                                                        Verifique la información o cree un nuevo cliente.
                                                    </p>
                                                    <div class="space"></div>
                                                    <button class="secondary" @click="abrirFormularioNuevo">
                                                        <i>person_add</i>
                                                        <span>Crear nuevo cliente</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>

                                        <!-- Filas de clientes (paginación virtual) -->
                                        <tr v-for="c in clientesVisibles" v-bind:key="c.Id_Cliente"
                                            style="font-size:0.80rem;">
                                            <td style="padding:4px 8px; line-height:1.3;">{{ c.Id_Fiscal }}</td>
                                            <td style="padding:4px 8px; line-height:1.3;">{{ nombreCompleto(c) }}</td>
                                            <td style="padding:4px 8px; line-height:1.3;">{{ c.email || '-' }}</td>
                                            <td style="padding:4px 8px; line-height:1.3;">{{ c.telefono || '-' }}</td>
                                            <td style="padding:4px 8px; line-height:1.3;">{{ c.ciudad || '-' }}</td>
                                            <td class="center-align" style="padding:4px 8px;">
                                                <span v-if="esActivo(c)" class="chip small green">Activo</span>
                                                <span v-else class="chip small red">Inactivo</span>
                                            </td>
                                            <td class="center-align" style="padding:4px 8px;">
                                                <button class="small-round border" v-on:click="abrirFormularioEditar(c)" title="Editar">
                                                    <i>edit</i>
                                                </button>
                                            </td>
                                        </tr>

                                        <!-- Indicador cargando más -->
                                        <tr v-if="cargandoMas">
                                            <td colspan="7" class="center-align" style="padding:10px;">
                                                <progress class="circle small"></progress>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Pie de tabla: contador -->
                            <div class="padding" style="padding-top:8px; padding-bottom:8px;">
                                <p class="tiny-text" style="margin:0; color: var(--on-surface-variant);">
                                    Mostrando <strong>{{ clientesVisibles.length }}</strong> de <strong>{{ clientesFiltrados.length }}</strong> clientes
                                    <span v-if="filtroIdFiscal.trim() || filtroNombre.trim()"> (filtrados)</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </article>
            </div>
            <!-- FIN PANTALLA BUSCAR -->

            <!-- PANTALLA: CLIENTE ENCONTRADO -->
            <div v-if="pantalla === 'encontrado' && clienteActual" class="margin">
                <h5 class="primary-text">Cliente Encontrado</h5>
                <div class="space"></div>

                <article class="border round primary-container">
                    <div class="row padding">
                        <h6 class="max primary-text">{{ nombreCompleto(clienteActual) }}</h6>
                        <button class="border" @click="verHistorialFacturas">
                            <i>receipt</i>
                            <span>Historial</span>
                        </button>
                        <button class="secondary" @click="abrirFormularioEditar(clienteActual)">
                            <i>edit</i>
                            <span>Editar</span>
                        </button>
                        <button class="tertiary" @click="irAFacturas">
                            <i>receipt_long</i>
                            <span>Crear Factura</span>
                        </button>
                    </div>
                    <div class="divider"></div>
                    <div class="padding grid">
                        <div class="s12 m4">
                            <p class="small-text upper bold">ID Fiscal</p>
                            <p class="primary-text">{{ clienteActual.Id_Fiscal }}</p>
                        </div>
                        <div class="s12 m4">
                            <p class="small-text upper bold">Email</p>
                            <p>{{ clienteActual.email || '-' }}</p>
                        </div>
                        <div class="s12 m4">
                            <p class="small-text upper bold">Teléfono</p>
                            <p>{{ clienteActual.telefono || '-' }}</p>
                        </div>
                        <div class="s12 m4">
                            <p class="small-text upper bold">Ciudad</p>
                            <p>{{ clienteActual.ciudad || '-' }}</p>
                        </div>
                        <div class="s12 m8">
                            <p class="small-text upper bold">Dirección</p>
                            <p>{{ clienteActual.direccion || '-' }}</p>
                        </div>
                    </div>
                    <div class="padding">
                        <span v-if="esActivo(clienteActual)" class="chip small green">Activo</span>
                        <span v-else class="chip small red">Inactivo</span>
                    </div>
                    <div class="padding">
                        <button class="border" @click="volverABuscar">
                            <i>arrow_back</i>
                            <span>Nueva Búsqueda</span>
                        </button>
                    </div>
                </article>
            </div>

            <!-- PANTALLA: FORMULARIO NUEVO CLIENTE -->
            <div v-if="pantalla === 'formulario_nuevo'" class="margin">
                <div class="row">
                    <h5 class="max primary-text">Nuevo Cliente</h5>
                    <button class="border" v-on:click="cancelarFormulario">
                        <i>close</i>
                        <span>Cancelar</span>
                    </button>
                </div>
                <div class="space"></div>

                <article class="border round">
                    <div class="primary-container padding">
                        <div class="row">
                            <i class="secondary-text">person_add</i>
                            <h6 class="secondary-text">Registro de Cliente</h6>
                        </div>
                    </div>

                    <div class="padding">
                        <p class="small-text bold primary-text">Identificación</p>
                        <div class="grid">
                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="text" v-model="form.Id_Fiscal" maxlength="20">
                                    <label>ID Fiscal <span class="secondary-text">* Obligatorio</span></label>
                                    <span class="helper">NIT o Cédula del cliente</span>
                                </div>
                            </div>
                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="email" v-model="form.email" maxlength="200">
                                    <label>Email <span class="secondary-text">* Obligatorio</span></label>
                                </div>
                            </div>
                        </div>

                        <div class="space"></div>
                        <p class="small-text bold primary-text">Nombres y Apellidos</p>
                        <div class="grid">
                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="text" v-model="form.Nm_Cliente1" maxlength="150">
                                    <label>Primer Nombre <span class="secondary-text">*</span></label>
                                </div>
                            </div>
                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="text" v-model="form.Nm_Cliente2" maxlength="150">
                                    <label>Segundo Nombre</label>
                                </div>
                            </div>
                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="text" v-model="form.Ap_Cliente1" maxlength="150">
                                    <label>Primer Apellido <span class="secondary-text">*</span></label>
                                </div>
                            </div>
                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="text" v-model="form.Ap_Cliente2" maxlength="150">
                                    <label>Segundo Apellido</label>
                                </div>
                            </div>
                        </div>

                        <div class="space"></div>
                        <p class="small-text bold primary-text">Contacto</p>
                        <div class="grid">
                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="text" v-model="form.telefono" maxlength="50">
                                    <label>Teléfono <span class="secondary-text">*</span></label>
                                </div>
                            </div>
                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="text" v-model="form.ciudad" maxlength="100">
                                    <label>Ciudad</label>
                                </div>
                            </div>
                            <div class="s12">
                                <div class="field border label">
                                    <input type="text" v-model="form.direccion" maxlength="300">
                                    <label>Dirección</label>
                                </div>
                            </div>
                        </div>

                        <div class="space"></div>
                        <nav class="right-align">
                            <button class="border" v-on:click="cancelarFormulario" v-bind:disabled="guardando">Cancelar</button>
                            <button class="secondary" v-on:click="guardarCliente"
                                    v-bind:disabled="guardando || !formularioValido">
                                <i>{{ guardando ? 'hourglass_empty' : 'save' }}</i>
                                <span>{{ guardando ? 'Guardando...' : 'GUARDAR CLIENTE' }}</span>
                            </button>
                        </nav>
                    </div>
                </article>
            </div>

            <!-- PANTALLA: FORMULARIO EDITAR CLIENTE -->
            <div v-if="pantalla === 'formulario_editar'" class="margin">
                <div class="row">
                    <h5 class="max primary-text">Editar Cliente</h5>
                    <button class="border" v-on:click="cancelarFormulario">
                        <i>close</i>
                        <span>Cancelar</span>
                    </button>
                </div>
                <div class="space"></div>

                <article class="border round">
                    <div class="primary-container padding">
                        <div class="row">
                            <i class="secondary-text">manage_accounts</i>
                            <h6 class="secondary-text">Edición de Cliente</h6>
                        </div>
                    </div>

                    <div class="padding">
                        <p class="small-text bold primary-text">Identificación</p>
                        <div class="grid">
                            <div class="s12 m6">
                                <div class="field filled label">
                                    <input type="text" v-model="form.Id_Fiscal" disabled>
                                    <label>ID Fiscal (No editable)</label>
                                </div>
                            </div>
                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="email" v-model="form.email" maxlength="200">
                                    <label>Email <span class="secondary-text">* Obligatorio</span></label>
                                </div>
                            </div>
                        </div>

                        <div class="space"></div>
                        <p class="small-text bold primary-text">Nombres y Apellidos </p>
                        <div class="grid">
                            <div class="s12 m6">
                                <div class="field filled label">
                                    <input type="text" v-model="form.Nm_Cliente1" maxlength="150">
                                    <label>Primer Nombre <span class="secondary-text">*</span></label>

                                </div>
                            </div>
                            <div class="s12 m6">
                                <div class="field filled label">
                                    <input type="text" v-model="form.Nm_Cliente2" maxlength="150">
                                    <label>Segundo Nombre</label>
                                </div>
                            </div>
                            <div class="s12 m6">
                                <div class="field filled label">
                                    <input type="text" v-model="form.Ap_Cliente1" maxlength="150">
                                    <label>Primer Apellido <span class="secondary-text">*</span></label>
                                </div>
                            </div>
                            <div class="s12 m6">
                                <div class="field filled label">
                                    <input type="text" v-model="form.Ap_Cliente2" maxlength="150">
                                    <label>Segundo Apellido</label>
                                </div>
                            </div>
                        </div>

                        <div class="space"></div>
                        <p class="small-text bold primary-text">Contacto</p>
                        <div class="grid">
                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="text" v-model="form.telefono" maxlength="50">
                                    <label>Teléfono <span class="secondary-text">*</span></label>
                                </div>
                            </div>
                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="text" v-model="form.ciudad" maxlength="100">
                                    <label>Ciudad</label>
                                </div>
                            </div>
                            <div class="s12">
                                <div class="field border label">
                                    <input type="text" v-model="form.direccion" maxlength="300">
                                    <label>Dirección</label>
                                </div>
                            </div>
                        </div>

                        <div class="space"></div>
                        <p class="small-text bold primary-text">Estado del Cliente</p>
                        <div class="field border label">
                            <select v-model="form.activo">
                                <option v-bind:value="true">Activo</option>
                                <option v-bind:value="false">Inactivo</option>
                            </select>
                            <label>Estado</label>
                        </div>
                        <div class="space"></div>
                        <article v-bind:class="form.activo ? 'green' : 'red'" class="round padding">
                            <i>fiber_manual_record</i>
                            <span>{{ form.activo ? 'CLIENTE ACTIVO' : 'CLIENTE INACTIVO' }}</span>
                        </article>

                        <div class="space"></div>
                        <nav class="right-align">
                            <button class="border" @click="cancelarFormulario" v-bind:disabled="guardando">Cancelar</button>
                            <button class="secondary" @click="guardarCliente"
                                    v-bind:disabled="guardando || !formularioValido">
                                <i>{{ guardando ? 'hourglass_empty' : 'save' }}</i>
                                <span>{{ guardando ? 'Guardando...' : 'GUARDAR CAMBIOS' }}</span>
                            </button>
                        </nav>
                    </div>
                </article>
            </div>

            <!-- PANTALLA: HISTORIAL DE FACTURAS -->
            <div v-if="pantalla === 'historial_facturas'" class="margin">
                <div class="row">
                    <h5 class="max primary-text">Historial de Facturas</h5>
                    <button class="border" @click="volverDeHistorial">
                        <i>arrow_back</i>
                        <span>Volver</span>
                    </button>
                </div>
                <p v-if="clienteActual">Cliente: <strong>{{ nombreCompleto(clienteActual) }}</strong></p>
                <div class="space"></div>

                <div v-if="cargandoFacturas" class="center-align padding">
                    <progress class="circle medium"></progress>
                    <p>Cargando facturas...</p>
                </div>

                <article v-else class="border round">
                    <div v-if="facturasCliente.length === 0" class="padding center-align">
                        <i class="extra secondary-text">receipt_long</i>
                        <div class="space"></div>
                        <h6>Sin facturas registradas</h6>
                        <p>Este cliente aún no tiene facturas emitidas.</p>
                        <div class="space"></div>
                        <button class="secondary" @click="irAFacturas">
                            <i>add</i>
                            <span>Crear primera factura</span>
                        </button>
                    </div>

                    <div v-else class="scroll">
                        <table class="border">
                            <thead>
                                <tr>
                                    <th>Número Factura</th>
                                    <th>Fecha Emisión</th>
                                    <th>Tipo</th>
                                    <th>Sucursal</th>
                                    <th>Valor</th>
                                    <th>Impuesto</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                    <th class="center-align">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="f in facturasCliente" :key="f.Id_Factura">
                                    <td><strong>{{ f.Numero_Factura }}</strong></td>
                                    <td>{{ formatFecha(f.Fecha_Emision) }}</td>
                                    <td>{{ f.Tipo_Factura }}</td>
                                    <td>{{ f.Sucursal_Emisora }}</td>
                                    <td>{{ formatCOP(f.Valor_Factura) }}</td>
                                    <td>{{ formatCOP(f.Valor_Impuesto) }}</td>
                                    <td class="bold">{{ formatCOP(parseFloat(f.Valor_Factura || 0) + parseFloat(f.Valor_Impuesto || 0)) }}</td>
                                    <td>
                                        <span v-if="f.Estado_Factura === 'GENERADA'" class="chip small green">{{ f.Estado_Factura }}</span>
                                        <span v-else-if="f.Estado_Factura === 'BORRADOR'" class="chip small orange">{{ f.Estado_Factura }}</span>
                                        <span v-else class="chip small">{{ f.Estado_Factura }}</span>
                                    </td>
                                    <td class="center-align">
                                        <button class="small-round border" @click="verDetalleFactura(f)" title="Ver detalle">
                                            <i>visibility</i>
                                        </button>
                                        <button class="small-round secondary" @click="editarFactura(f)" title="Editar">
                                            <i>edit</i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="padding">
                            <article class="surface-container round padding">
                                <p class="small-text bold">Resumen</p>
                                <div class="divider"></div>
                                <div class="space"></div>
                                <p>Total de facturas: <strong>{{ facturasCliente.length }}</strong></p>
                            </article>
                        </div>
                    </div>
                </article>
            </div>

            <!-- PANTALLA: DETALLE DE FACTURA -->
            <div v-if="pantalla === 'detalle_factura' && facturaSeleccionada" class="margin">
                <div class="row">
                    <h5 class="max primary-text">Detalle de Factura</h5>
                    <button class="border" @click="editarFactura(facturaSeleccionada)">
                        <i>edit</i>
                        <span>Editar</span>
                    </button>
                    <button class="border" @click="pantalla = pantallaAnterior">
                        <i>arrow_back</i>
                        <span>Volver</span>
                    </button>
                </div>
                <div class="space"></div>

                <article class="border round">
                    <div class="primary-container padding">
                        <div class="row">
                            <i class="secondary-text">receipt_long</i>
                            <h6 class="max secondary-text">{{ facturaSeleccionada.Numero_Factura }}</h6>
                            <span v-if="facturaSeleccionada.Estado_Factura === 'GENERADA'" class="chip small green">{{ facturaSeleccionada.Estado_Factura }}</span>
                            <span v-else-if="facturaSeleccionada.Estado_Factura === 'BORRADOR'" class="chip small orange">{{ facturaSeleccionada.Estado_Factura }}</span>
                            <span v-else class="chip small">{{ facturaSeleccionada.Estado_Factura }}</span>
                        </div>
                    </div>

                    <div class="padding">
                        <p class="small-text bold primary-text">Información General</p>
                        <article class="surface-container round padding">
                            <div class="grid">
                                <div class="s12 m3">
                                    <p class="tiny-text upper bold">Número Factura</p>
                                    <p>{{ facturaSeleccionada.Numero_Factura }}</p>
                                </div>
                                <div class="s12 m3">
                                    <p class="tiny-text upper bold">Secuencia</p>
                                    <p>{{ facturaSeleccionada.Secuencia_Factura }}</p>
                                </div>
                                <div class="s12 m3">
                                    <p class="tiny-text upper bold">Fecha Emisión</p>
                                    <p>{{ formatFecha(facturaSeleccionada.Fecha_Emision) }}</p>
                                </div>
                                <div class="s12 m3">
                                    <p class="tiny-text upper bold">Sucursal Emisora</p>
                                    <p>{{ facturaSeleccionada.Sucursal_Emisora }}</p>
                                </div>
                            </div>
                        </article>

                        <div class="space"></div>
                        <p class="small-text bold primary-text">Tipo y Modalidad</p>
                        <article class="surface-container round padding">
                            <div class="grid">
                                <div class="s12 m4">
                                    <p class="tiny-text upper bold">Tipo Factura</p>
                                    <p>{{ facturaSeleccionada.Tipo_Factura }}</p>
                                </div>
                                <div class="s12 m4">
                                    <p class="tiny-text upper bold">Modalidad</p>
                                    <p>{{ facturaSeleccionada.modalidad }}</p>
                                </div>
                                <div class="s12 m4">
                                    <p class="tiny-text upper bold">Tipo Servicio</p>
                                    <p>{{ facturaSeleccionada.Tipo_Servicio }}</p>
                                </div>
                                <div class="s12" v-if="facturaSeleccionada.Codigo_Ean_Fedex">
                                    <p class="tiny-text upper bold">Código EAN FEDEX</p>
                                    <p>{{ facturaSeleccionada.Codigo_Ean_Fedex }}</p>
                                </div>
                            </div>
                        </article>

                        <div class="space"></div>
                        <p class="small-text bold primary-text">Valores</p>
                        <article class="primary-container round padding">
                            <div class="grid">
                                <div class="s12 m3">
                                    <p class="tiny-text">Valor Factura</p>
                                    <h6 class="secondary-text">{{ formatCOP(facturaSeleccionada.Valor_Factura) }}</h6>
                                </div>
                                <div class="s12 m3">
                                    <p class="tiny-text">Base Cálculo</p>
                                    <h6 class="secondary-text">{{ formatCOP(facturaSeleccionada.Base_Calculo) }}</h6>
                                </div>
                                <div class="s12 m3">
                                    <p class="tiny-text">Impuesto ({{ facturaSeleccionada.Porcentaje_Impuesto }}%)</p>
                                    <h6 class="secondary-text">{{ formatCOP(facturaSeleccionada.Valor_Impuesto) }}</h6>
                                </div>
                                <div class="s12 m3">
                                    <p class="tiny-text">TOTAL</p>
                                    <h5 class="secondary-text">{{ formatCOP(parseFloat(facturaSeleccionada.Valor_Factura || 0) + parseFloat(facturaSeleccionada.Valor_Impuesto || 0)) }}</h5>
                                </div>
                            </div>
                        </article>

                        <div class="space" v-if="facturaSeleccionada.observaciones"></div>
                        <p class="small-text bold primary-text" v-if="facturaSeleccionada.observaciones">Observaciones</p>
                        <article class="surface-container round padding" v-if="facturaSeleccionada.observaciones">
                            <p>{{ facturaSeleccionada.observaciones }}</p>
                        </article>
                    </div>
                </article>
            </div>

            <!-- PANTALLA: EDITAR FACTURA -->
            <div v-if="pantalla === 'editar_factura'" class="margin">
                <div class="row">
                    <h5 class="max primary-text">Editar Factura</h5>
                    <button class="border" @click="cancelarEdicionFactura">
                        <i>close</i>
                        <span>Cancelar</span>
                    </button>
                </div>
                <div class="space"></div>

                <article class="border round">
                    <div class="primary-container padding">
                        <div class="row">
                            <i class="secondary-text">edit_note</i>
                            <h6 class="secondary-text">{{ formFactura.Numero_Factura }}</h6>
                        </div>
                    </div>

                    <div class="padding">
                        <p class="small-text bold primary-text">Datos Generales</p>
                        <div class="grid">
                            <div class="s12 m4">
                                <div class="field border label">
                                    <select v-model="formFactura.Sucursal_Emisora">
                                        <option value="">Seleccione...</option>
                                        <option value="FEDEX-BOG">FEDEX-BOG - Bogotá</option>
                                        <option value="FEDEX-CLO">FEDEX-CLO - Cali</option>
                                        <option value="FEDEX-MDE">FEDEX-MDE - Medellín</option>
                                    </select>
                                    <label>Sucursal Emisora <span class="secondary-text">*</span></label>
                                </div>
                            </div>

                            <div class="s12 m4">
                                <div class="field border label">
                                    <input type="text" v-model="formFactura.Numero_Factura" maxlength="50">
                                    <label>Número de Factura <span class="secondary-text">*</span></label>
                                </div>
                            </div>

                            <div class="s12 m4">
                                <div class="field border label">
                                    <input type="number" v-model.number="formFactura.Secuencia_Factura" min="1">
                                    <label>Secuencia</label>
                                </div>
                            </div>

                            <div class="s12 m4">
                                <div class="field border label">
                                    <input type="date" v-model="formFactura.Fecha_Emision">
                                    <label>Fecha de Emisión <span class="secondary-text">*</span></label>
                                </div>
                            </div>

                            <div class="s12 m4">
                                <div class="field border label">
                                    <select v-model="formFactura.Tipo_Factura">
                                        <option value="">Seleccione...</option>
                                        <option value="SERVICIO">SERVICIO</option>
                                        <option value="TRANSPORTE">TRANSPORTE</option>
                                    </select>
                                    <label>Tipo de Factura <span class="secondary-text">*</span></label>
                                </div>
                            </div>

                            <div class="s12 m4">
                                <div class="field border label">
                                    <select v-model="formFactura.Estado_Factura">
                                        <option value="GENERADA">GENERADA</option>
                                        <option value="BORRADOR">BORRADOR</option>
                                        <option value="ANULADA">ANULADA</option>
                                    </select>
                                    <label>Estado</label>
                                </div>
                            </div>

                            <div class="s12 m4">
                                <div class="field border label">
                                    <select v-model="formFactura.modalidad">
                                        <option value="">Seleccione...</option>
                                        <option value="CONTADO">CONTADO</option>
                                        <option value="CRÉDITO">CRÉDITO</option>
                                    </select>
                                    <label>Modalidad <span class="secondary-text">*</span></label>
                                </div>
                            </div>

                            <div class="s12 m4">
                                <div class="field border label">
                                    <select v-model="formFactura.Tipo_Servicio">
                                        <option value="">Seleccione...</option>
                                        <option value="ENVÍO">ENVÍO</option>
                                        <option value="TRANSPORTE">TRANSPORTE</option>
                                        <option value="ALMACENAMIENTO">ALMACENAMIENTO</option>
                                    </select>
                                    <label>Tipo de Servicio <span class="secondary-text">*</span></label>
                                </div>
                            </div>

                            <div class="s12 m4">
                                <div class="field border label">
                                    <input type="text" v-model="formFactura.Codigo_Ean_Fedex" maxlength="50">
                                    <label>Código EAN FEDEX</label>
                                </div>
                            </div>
                        </div>

                        <div class="space"></div>
                        <p class="small-text bold primary-text">Valores e Impuestos</p>
                        <div class="grid">
                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="number" v-model.number="formFactura.Valor_Factura"
                                           step="0.01" min="0" @input="calcularImpuestoFactura">
                                    <label>Valor Factura <span class="secondary-text">*</span></label>
                                    <span class="helper">En COP</span>
                                </div>
                            </div>

                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="number" v-model.number="formFactura.Base_Calculo"
                                           step="0.01" min="0">
                                    <label>Base de Cálculo</label>
                                </div>
                            </div>

                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="number" v-model.number="formFactura.Porcentaje_Impuesto"
                                           step="0.01" min="0" max="100" @input="calcularImpuestoFactura">
                                    <label>Porcentaje Impuesto (%)</label>
                                </div>
                            </div>

                            <div class="s12 m6">
                                <div class="field border label">
                                    <input type="number" v-model.number="formFactura.Valor_Impuesto"
                                           step="0.01" min="0" readonly>
                                    <label>Valor Impuesto (calculado)</label>
                                </div>
                            </div>
                        </div>

                        <div class="space"></div>
                        <div class="field border label">
                            <textarea v-model="formFactura.observaciones" rows="3"></textarea>
                            <label>Observaciones</label>
                        </div>

                        <div class="space"></div>
                        <article class="surface-container round padding">
                            <h6 class="primary-text">Resumen</h6>
                            <div class="divider"></div>
                            <div class="space"></div>
                            <div class="row space-between">
                                <span>Valor Factura:</span>
                                <span class="bold">{{ formatCOP(formFactura.Valor_Factura) }}</span>
                            </div>
                            <div class="row space-between">
                                <span>Impuesto ({{ formFactura.Porcentaje_Impuesto }}%):</span>
                                <span class="bold">{{ formatCOP(formFactura.Valor_Impuesto) }}</span>
                            </div>
                            <div class="divider"></div>
                            <div class="row space-between">
                                <h6 class="primary-text">TOTAL:</h6>
                                <h6 class="secondary-text">{{ formatCOP(valorTotalFactura) }}</h6>
                            </div>
                        </article>

                        <div class="space"></div>
                        <nav class="space-between">
                            <button class="border" @click="cancelarEdicionFactura" :disabled="guardandoFactura">
                                Cancelar
                            </button>
                            <button class="secondary" @click="guardarFactura" :disabled="guardandoFactura || !formFacturaValido">
                                <i>{{ guardandoFactura ? 'hourglass_empty' : 'save' }}</i>
                                <span>{{ guardandoFactura ? 'Guardando...' : 'GUARDAR CAMBIOS' }}</span>
                            </button>
                        </nav>
                    </div>
                </article>
            </div>

        </main>

        <!-- Snackbar -->
        <div class="snackbar"
             v-bind:class="['snackbar', snackbar.tipo, { active: snackbar.mostrar }]">
            <i>{{ snackbar.icono }}</i>
            <span>{{ snackbar.mensaje }}</span>
        </div>

    </div>
    <script src="./clientes.js"></script>
</body>
</html>